name: Caller â€” dispatch to ci-dispatcher

on:
  workflow_call:
    inputs:
      workspace:
        description: "Workspace path (relative to caller repo root)"
        required: true
        type: string
      group:
        description: "Group name"
        required: true
        type: string
      project:
        description: "Project name"
        required: true
        type: string
      environment:
        description: "Environment name (dev, stage, prod)"
        required: true
        type: string
      instance:
        description: "Instance (author|publish|both)"
        required: true
        type: string
      pool:
        description: "Pool (kstl|kfr|gen|dam|kstl65|kfr65|newkstl65|kfr63|...)"
        required: true
        type: string
    secrets:
      GH_Token:
        required: true

  workflow_dispatch:
    inputs:
      workspace:
        description: "Workspace path (relative to repo root)"
        required: true
        type: string
      group:
        description: "Group name"
        required: true
        type: string
      project:
        description: "Project name"
        required: true
        type: string
      environment:
        description: "Environment name (dev, stage, prod)"
        required: true
        type: string
      instance:
        description: "Instance (author|publish|both)"
        required: true
        type: string
      pool:
        description: "Pool (kstl|kfr|gen|dam|kstl65|kfr65|newkstl65|kfr63|...)"
        required: true
        type: string

permissions:
  contents: read

jobs:
  call-ci-dispatcher:
    # <-- CORRECT: 'uses' at job level to call external reusable workflow
    uses: rakesh26955/kellanova-dmit-template-advanced-test/.github/workflows/ci-dispatcher.yml@main
    with:
      # Prefer workflow_call inputs; fall back to workflow_dispatch inputs via github.event.inputs
      workspace: ${{ inputs.workspace || github.event.inputs.workspace }}
      group:     ${{ inputs.group     || github.event.inputs.group }}
      project:   ${{ inputs.project   || github.event.inputs.project }}
      environment:${{ inputs.environment || github.event.inputs.environment }}
      instance:  ${{ inputs.instance  || github.event.inputs.instance }}
      pool:      ${{ inputs.pool      || github.event.inputs.pool }}
    secrets:
      GH_Token: ${{ secrets.GH_Token }}
